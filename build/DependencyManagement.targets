<!--Code from OrcharCore project : https://github.com/OrchardCMS/OrchardCore/blob/dev/src/OrchardCore.Build/OrchardCore.Commons.targets -->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
	<Target Name="ApplyDependency" BeforeTargets="CollectPackageReferences" DependsOnTargets="ApplyDependencyItems" />

	<Target Name="ApplyDependencyItems" Inputs="@(Dependency)" Outputs="%(Dependency.Identity)">
		<PropertyGroup>
			<_DependencyIdentity>%(Dependency.Identity)</_DependencyIdentity>
			<_DependencyVersion>%(Dependency.Version)</_DependencyVersion>
		</PropertyGroup>
		<Warning Condition=" '%(PackageReference.Identity)' == '$(_DependencyIdentity)' and '%(PackageReference.Version)' == '$(_DependencyVersion)' "
				 Code="FF0001"
				 Text="PackageReference %(PackageReference.Identity)@%(PackageReference.Version) Version attribute is not needed"
				 File="$(MSBuildProjectFullPath)" />
		<ItemGroup>
			<PackageReference Condition=" '%(Identity)' == '$(_DependencyIdentity)' " Version="$(_DependencyVersion)" ManagedVersion="true" />
		</ItemGroup>
	</Target>

	<Target Name="BeforeDependency" BeforeTargets="ApplyDependency">
		<Message Text="BeforeDependency: %(PackageReference.Identity)@%(PackageReference.Version)" Importance="low" />
	</Target>

	<Target Name="AfterDependency" AfterTargets="ApplyDependency">
		<Message Text="AfterDependency: %(PackageReference.Identity)@%(PackageReference.Version)" Importance="low" />

		<ItemGroup>
			<UnmanagedPackageReference Include="@(PackageReference)" />
			<UnmanagedPackageReference Remove="@(UnmanagedPackageReference)" Condition=" '%(UnmanagedPackageReference.ManagedVersion)' == 'true' " />
			<UnmanagedPackageReference Remove="@(UnmanagedPackageReference)" Condition=" '%(UnmanagedPackageReference.IsImplicitlyDefined)' == 'true' " />
			<UnmanagedPackageReference Remove="@(UnmanagedPackageReference)" Condition=" $([System.String]::Copy('%(Identity)').StartsWith('System.')) " />
		</ItemGroup>
		<Warning Condition=" '@(UnmanagedPackageReference)' != '' and '%(Identity)' != 'Microsoft.AspNetCore.App' "
				 Code="FF0002"
				 Text="%(UnmanagedPackageReference.Identity)@%(UnmanagedPackageReference.Version) is an unmanaged PackageReference"
				 File="$(MSBuildProjectFullPath)" />
	</Target>
</Project>